# ============================================================================
# CoreVital - Default Configuration
# 
# Purpose: Default configuration for all monitoring runs
# Inputs: None (base configuration)
# Outputs: Configuration loaded by config.py
# Dependencies: None
# Usage: Override via CLI arguments or environment variables
# 
# Changelog:
#   2026-01-13: Initial configuration for Phase-0
#   2026-02-07: Phase-1a — added new metric names to attention.stats and logits.stats
#   2026-02-10: Phase-1b — added prompt_telemetry section (enabled, sparse_threshold)
# ============================================================================

model:
  hf_id: "gpt2"
  revision: null
  trust_remote_code: false
  dtype: "auto"  # auto, float32, float16, bfloat16
  load_in_4bit: false
  load_in_8bit: false

device:
  requested: "auto"  # auto, cpu, cuda

generation:
  max_new_tokens: 20
  do_sample: true
  temperature: 0.8
  top_k: 50
  top_p: 0.95
  seed: 42
  num_beams: 1      # > 1 enables beam search (CausalLM)
  early_stopping: false

summaries:
  hidden:
    enabled: true
    stats:
      - mean
      - std
      - l2_norm_mean
      - max_abs
    sketch:
      enabled: false   # Set true for debugging; off by default to keep payload small
      method: "randproj"
      dim: 32
      seed: 0
  
  attention:
    enabled: true
    stats:
      - entropy_mean
      - entropy_min
      - entropy_max
      - concentration_max
      - concentration_min
      - collapsed_head_count
      - focused_head_count
  
  logits:
    enabled: true
    stats:
      - entropy
      - top_k_margin
      - topk_mass
      - topk_probs
      - perplexity
      - surprisal
    topk: 5

sink:
  type: "sqlite"  # sqlite (default), local_file (JSON), datadog, prometheus
  output_dir: "runs"
  remote_url: null
  sqlite_path: "runs/corevital.db"
  sqlite_backup_json: false

prompt_telemetry:
  enabled: true
  sparse_threshold: 0.01   # Store attention weights above this value
  sparse_max_per_head: 50  # Cap connections per head to limit payload size

# Foundation F2: what to store per run (summary = small payload, full = everything)
capture:
  capture_mode: "full"   # summary | full | on_risk
  risk_threshold: 0.7    # For on_risk: store full when risk >= this (Phase-2)

logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"